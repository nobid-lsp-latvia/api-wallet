// SPDX-License-Identifier: EUPL-1.2

package attestation

import (
	"testing"
	"time"

	"azugo.io/azugo"
	"github.com/go-quicktest/qt"
)

func TestIOSAttestation(t *testing.T) {
	app := azugo.NewTestApp()

	s, err := New(app.App)
	qt.Assert(t, qt.IsNil(err))

	r, err := s.verifyIOS("o2NmbXRvYXBwbGUtYXBwYXR0ZXN0Z2F0dFN0bXSiY3g1Y4JZA18wggNbMIIC4aADAgECAgYBlQRuJ9IwCgYIKoZIzj0EAwIwTzEjMCEGA1UEAwwaQXBwbGUgQXBwIEF0dGVzdGF0aW9uIENBIDExEzARBgNVBAoMCkFwcGxlIEluYy4xEzARBgNVBAgMCkNhbGlmb3JuaWEwHhcNMjUwMjEzMTIyODAyWhcNMjUxMTEzMTgyMTAyWjCBkTFJMEcGA1UEAwxAYWEzYzZkNjlkYTUzNzAwZGY0NTNjZWIwM2Q1YTU4NDQwMDA3ZWNmNjcyNTgyMDQxNGRhYWZlZTgyZmQzYzMzMTEaMBgGA1UECwwRQUFBIENlcnRpZmljYXRpb24xEzARBgNVBAoMCkFwcGxlIEluYy4xEzARBgNVBAgMCkNhbGlmb3JuaWEwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAARUbBCN3Y-tWbV57Li-DrA3MqQhNJKg3y-hv3VdgEHpYDUJv4oOwz_yQnx5fWrB1cBxCDuBR2Sm_5_kPL0W8zwLo4IBZDCCAWAwDAYDVR0TAQH_BAIwADAOBgNVHQ8BAf8EBAMCBPAwegYJKoZIhvdjZAgFBG0wa6QDAgEKv4kwAwIBAb-JMQMCAQC_iTIDAgEBv4kzAwIBAb-JNBsEGUZKRlNVVlozR0gubHYuenpkYXRzLmVkaW2lBgQEc2tzIL-JNgMCAQW_iTcDAgEAv4k5AwIBAL-JOgMCAQC_iTsDAgEAMIGOBgkqhkiG92NkCAcEgYAwfr-KeAYEBDE4LjO_iFADAgEAv4p7BwQFMjJENjO_inwGBAQxOC4zv4p9BgQEMTguM7-KfgMCAQC_iwoPBA0yMi40LjYzLjAuMCwwv4sLDwQNMjIuNC42My4wLjAsML-LDA8EDTIyLjQuNjMuMC4wLDC_iAIKBAhpcGhvbmVvczAzBgkqhkiG92NkCAIEJjAkoSIEIL6969gnm0rZlACUlMpnVWKB1BsprhvY46E1BFlpm_tYMAoGCCqGSM49BAMCA2gAMGUCMQDzTV3VSslyWjsBPqx7aUSSoyTNFTLZryYjMxFzPMAaQwZufjvdhn7zzgpxyOI69noCMDBNZr3Tj2fLGXXherTs_tiQrgL-kAw13sGz8hxiOpkQnXmO3U3at5uu6DvlLCfnVlkCRzCCAkMwggHIoAMCAQICEAm6xeG8QBrZ1FOVvDgaCFQwCgYIKoZIzj0EAwMwUjEmMCQGA1UEAwwdQXBwbGUgQXBwIEF0dGVzdGF0aW9uIFJvb3QgQ0ExEzARBgNVBAoMCkFwcGxlIEluYy4xEzARBgNVBAgMCkNhbGlmb3JuaWEwHhcNMjAwMzE4MTgzOTU1WhcNMzAwMzEzMDAwMDAwWjBPMSMwIQYDVQQDDBpBcHBsZSBBcHAgQXR0ZXN0YXRpb24gQ0EgMTETMBEGA1UECgwKQXBwbGUgSW5jLjETMBEGA1UECAwKQ2FsaWZvcm5pYTB2MBAGByqGSM49AgEGBSuBBAAiA2IABK5bN6B3TXmyNY9A59HyJibxwl_vF4At6rOCalmHT_jSrRUleJqiZgQZEki2PLlnBp6Y02O9XjcPv6COMp6Ac6mF53Ruo1mi9m8p2zKvRV4hFljVZ6-eJn6yYU3CGmbOmaNmMGQwEgYDVR0TAQH_BAgwBgEB_wIBADAfBgNVHSMEGDAWgBSskRBTM72-aEH_pwyp5frq5eWKoTAdBgNVHQ4EFgQUPuNdHAQZqcm0MfiEdNbh4Vdy45swDgYDVR0PAQH_BAQDAgEGMAoGCCqGSM49BAMDA2kAMGYCMQC7voiNc40FAs-8_WZtCVdQNbzWhyw_hDBJJint0fkU6HmZHJrota7406hUM_e2DQYCMQCrOO3QzIHtAKRSw7pE-ZNjZVP-zCl_LrTfn16-WkrKtplcS4IN-QQ4b3gHu1iUObdncmVjZWlwdFkOyTCABgkqhkiG9w0BBwKggDCAAgEBMQ8wDQYJYIZIAWUDBAIBBQAwgAYJKoZIhvcNAQcBoIAkgASCA-gxggSBMCECAQICAQEEGUZKRlNVVlozR0gubHYuenpkYXRzLmVkaW0wggNpAgEDAgEBBIIDXzCCA1swggLhoAMCAQICBgGVBG4n0jAKBggqhkjOPQQDAjBPMSMwIQYDVQQDDBpBcHBsZSBBcHAgQXR0ZXN0YXRpb24gQ0EgMTETMBEGA1UECgwKQXBwbGUgSW5jLjETMBEGA1UECAwKQ2FsaWZvcm5pYTAeFw0yNTAyMTMxMjI4MDJaFw0yNTExMTMxODIxMDJaMIGRMUkwRwYDVQQDDEBhYTNjNmQ2OWRhNTM3MDBkZjQ1M2NlYjAzZDVhNTg0NDAwMDdlY2Y2NzI1ODIwNDE0ZGFhZmVlODJmZDNjMzMxMRowGAYDVQQLDBFBQUEgQ2VydGlmaWNhdGlvbjETMBEGA1UECgwKQXBwbGUgSW5jLjETMBEGA1UECAwKQ2FsaWZvcm5pYTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABFRsEI3dj61ZtXnsuL4OsDcypCE0kqDfL6G_dV2AQelgNQm_ig7DP_JCfHl9asHVwHEIO4FHZKb_n-Q8vRbzPAujggFkMIIBYDAMBgNVHRMBAf8EAjAAMA4GA1UdDwEB_wQEAwIE8DB6BgkqhkiG92NkCAUEbTBrpAMCAQq_iTADAgEBv4kxAwIBAL-JMgMCAQG_iTMDAgEBv4k0GwQZRkpGU1VWWjNHSC5sdi56emRhdHMuZWRpbaUGBARza3Mgv4k2AwIBBb-JNwMCAQC_iTkDAgEAv4k6AwIBAL-JOwMCAQAwgY4GCSqGSIb3Y2QIBwSBgDB-v4p4BgQEMTguM7-IUAMCAQC_insHBAUyMkQ2M7-KfAYEBDE4LjO_in0GBAQxOC4zv4p-AwIBAL-LCg8EDTIyLjQuNjMuMC4wLDC_iwsPBA0yMi40LjYzLjAuMCwwv4sMDwQNMjIuNC42My4wLjAsML-IAgoECGlwaG9uZW9zMDMGCSqGSIb3Y2QIAgQmMCShIgQgvr3r2CebStmUAJSUymdVYoHUGymuG9jjoTUEWWmb-1gwCgYIKoZIzj0EAwIDaAAwZQIxAPNNXdVKyXJaOwE-rHtpRJKjJM0VMtmvJiMzEXM8wBpDBm5-O92GfvPOCnHI4jr2egIwME1mvdOPZ8sZdeF6tOz-2JCuAv6QDDXewbPyHGI6mRCdeY7dTdq3m67oO-UsJ-dWMCgCAQQCAQEEILp4Fr-PAc_qQUFA3l2uIiOwA2Gjlhd6nLQQ_2HyABWtMGACAQUCAQEEWENDVE9oa0ZwWGtuUDlPenRYdFJ6Q0NZdG1UWmxVMjI4BIGdUytVWHRGeXU5bDk0U3pQa09iaHNQSXJrMFNmaXBKUUc4QWN3Nmo4YkQyb1llOE9SbmJCYWF3PT0wDgIBBgIBAQQGQVRURVNUMA8CAQcCAQEEB3NhbmRib3gwIAIBDAIBAQQYMjAyNS0wMi0xNFQxMjoyODowMi45MzFaMCACARUCAQEEGDIwMjUtMDUtMTVUMTI6Mjg6MDIuOTMxWgAAAAAAAKCAMIIDrzCCA1SgAwIBAgIQQgTTLU5jzN-_g-uYr1V2MTAKBggqhkjOPQQDAjB8MTAwLgYDVQQDDCdBcHBsZSBBcHBsaWNhdGlvbiBJbnRlZ3JhdGlvbiBDQSA1IC0gRzExJjAkBgNVBAsMHUFwcGxlIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MRMwEQYDVQQKDApBcHBsZSBJbmMuMQswCQYDVQQGEwJVUzAeFw0yNTAxMjIxODI2MTFaFw0yNjAyMTcxOTU2MDRaMFoxNjA0BgNVBAMMLUFwcGxpY2F0aW9uIEF0dGVzdGF0aW9uIEZyYXVkIFJlY2VpcHQgU2lnbmluZzETMBEGA1UECgwKQXBwbGUgSW5jLjELMAkGA1UEBhMCVVMwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASbhpiZl9TpRtzLvkQ_K_cpEdNAa8QvH8IkqxULRe6S-mvUrPStHBwRik0k4j63UoGiU4lhtCrDk4h7hB9jD-zjo4IB2DCCAdQwDAYDVR0TAQH_BAIwADAfBgNVHSMEGDAWgBTZF_5LZ5A4S5L0287VV4AUC489yTBDBggrBgEFBQcBAQQ3MDUwMwYIKwYBBQUHMAGGJ2h0dHA6Ly9vY3NwLmFwcGxlLmNvbS9vY3NwMDMtYWFpY2E1ZzEwMTCCARwGA1UdIASCARMwggEPMIIBCwYJKoZIhvdjZAUBMIH9MIHDBggrBgEFBQcCAjCBtgyBs1JlbGlhbmNlIG9uIHRoaXMgY2VydGlmaWNhdGUgYnkgYW55IHBhcnR5IGFzc3VtZXMgYWNjZXB0YW5jZSBvZiB0aGUgdGhlbiBhcHBsaWNhYmxlIHN0YW5kYXJkIHRlcm1zIGFuZCBjb25kaXRpb25zIG9mIHVzZSwgY2VydGlmaWNhdGUgcG9saWN5IGFuZCBjZXJ0aWZpY2F0aW9uIHByYWN0aWNlIHN0YXRlbWVudHMuMDUGCCsGAQUFBwIBFilodHRwOi8vd3d3LmFwcGxlLmNvbS9jZXJ0aWZpY2F0ZWF1dGhvcml0eTAdBgNVHQ4EFgQUm66zxSVlvFzL2OtKpkdRpynw2sIwDgYDVR0PAQH_BAQDAgeAMA8GCSqGSIb3Y2QMDwQCBQAwCgYIKoZIzj0EAwIDSQAwRgIhAP5bCbIDKU3qZPOXfjQwUcw0UxG5VO_AqBXgBZ5BnAk7AiEAjhQPQOk3_YfNEjF7rW1YayAAHK00b7jnJ4fmiLDGHIMwggL5MIICf6ADAgECAhBW-4PUK_-NwzeZI7Varm69MAoGCCqGSM49BAMDMGcxGzAZBgNVBAMMEkFwcGxlIFJvb3QgQ0EgLSBHMzEmMCQGA1UECwwdQXBwbGUgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkxEzARBgNVBAoMCkFwcGxlIEluYy4xCzAJBgNVBAYTAlVTMB4XDTE5MDMyMjE3NTMzM1oXDTM0MDMyMjAwMDAwMFowfDEwMC4GA1UEAwwnQXBwbGUgQXBwbGljYXRpb24gSW50ZWdyYXRpb24gQ0EgNSAtIEcxMSYwJAYDVQQLDB1BcHBsZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTETMBEGA1UECgwKQXBwbGUgSW5jLjELMAkGA1UEBhMCVVMwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASSzmO9fYaxqygKOxzhr_sElICRrPYx36bLKDVvREvhIeVX3RKNjbqCfJW-Sfq-M8quzQQZ8S9DJfr0vrPLg366o4H3MIH0MA8GA1UdEwEB_wQFMAMBAf8wHwYDVR0jBBgwFoAUu7DeoVgziJqkipnevr3rr9rLJKswRgYIKwYBBQUHAQEEOjA4MDYGCCsGAQUFBzABhipodHRwOi8vb2NzcC5hcHBsZS5jb20vb2NzcDAzLWFwcGxlcm9vdGNhZzMwNwYDVR0fBDAwLjAsoCqgKIYmaHR0cDovL2NybC5hcHBsZS5jb20vYXBwbGVyb290Y2FnMy5jcmwwHQYDVR0OBBYEFNkX_ktnkDhLkvTbztVXgBQLjz3JMA4GA1UdDwEB_wQEAwIBBjAQBgoqhkiG92NkBgIDBAIFADAKBggqhkjOPQQDAwNoADBlAjEAjW-mn6Hg5OxbTnOKkn89eFOYj_TaH1gew3VK_jioTCqDGhqqDaZkbeG5k-jRVUztAjBnOyy04eg3B3fL1ex2qBo6VTs_NWrIxeaSsOFhvoBJaeRfK6ls4RECqsxh2Ti3c0owggJDMIIByaADAgECAggtxfyI0sVLlTAKBggqhkjOPQQDAzBnMRswGQYDVQQDDBJBcHBsZSBSb290IENBIC0gRzMxJjAkBgNVBAsMHUFwcGxlIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MRMwEQYDVQQKDApBcHBsZSBJbmMuMQswCQYDVQQGEwJVUzAeFw0xNDA0MzAxODE5MDZaFw0zOTA0MzAxODE5MDZaMGcxGzAZBgNVBAMMEkFwcGxlIFJvb3QgQ0EgLSBHMzEmMCQGA1UECwwdQXBwbGUgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkxEzARBgNVBAoMCkFwcGxlIEluYy4xCzAJBgNVBAYTAlVTMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAEmOkvPUBypO2TInKBExzdEJXxxaNOcdwUFtkO5aYFKndke19OONO7HES1f_UftjJiXcnphFtPME8RWgD9WFgMpfUPLE0HRxN12peXl28xXO0rnXsgO9i5VNlemaQ6UQoxo0IwQDAdBgNVHQ4EFgQUu7DeoVgziJqkipnevr3rr9rLJKswDwYDVR0TAQH_BAUwAwEB_zAOBgNVHQ8BAf8EBAMCAQYwCgYIKoZIzj0EAwMDaAAwZQIxAIPpwcQWXhpdNBjZ7e_0bA4ARku437JGEcUP_eZ6jKGma87CA9Sc9ZPGdLhq36ojFQIwbWaKEMrUDdRPzY1DPrSKY6UzbuNt2he3ZB_IUyb5iGJ0OQsXW8tRqAzoGAPnorIoAAAxgf0wgfoCAQEwgZAwfDEwMC4GA1UEAwwnQXBwbGUgQXBwbGljYXRpb24gSW50ZWdyYXRpb24gQ0EgNSAtIEcxMSYwJAYDVQQLDB1BcHBsZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTETMBEGA1UECgwKQXBwbGUgSW5jLjELMAkGA1UEBhMCVVMCEEIE0y1OY8zfv4PrmK9VdjEwDQYJYIZIAWUDBAIBBQAwCgYIKoZIzj0EAwIERzBFAiBSadMI0T5eXLhpoKOl3uE6xMdF8wKdZC-x6GUcB6FpbAIhAKdyVXVu1OKaqOY_fiI-iXse8WOHVOFi2HZ8TsAIiO05AAAAAAAAaGF1dGhEYXRhWKTb1abIFDP5090qXKzCHLHVm6TydNi4gAW-pLhFFlVBaUAAAAAAYXBwYXR0ZXN0ZGV2ZWxvcAAgqjxtadpTcA30U86wPVpYRAAH7PZyWCBBTar-6C_TwzGlAQIDJiABIVggVGwQjd2PrVm1eey4vg6wNzKkITSSoN8vob91XYBB6WAiWCA1Cb-KDsM_8kJ8eX1qwdXAcQg7gUdkpv-f5Dy9FvM8Cw", []byte("abc"), "qjxtadpTcA30U86wPVpYRAAH7PZyWCBBTar+6C/TwzE=", time.Date(2025, 0o2, 20, 10, 0, 0, 0, time.UTC))
	qt.Assert(t, qt.IsNil(err))
	qt.Check(t, qt.Equals(r.HardwareKeyTag, "qjxtadpTcA30U86wPVpYRAAH7PZyWCBBTar+6C/TwzE="))
	qt.Check(t, qt.Equals(r.CertsIssued, 0))
	qt.Check(t, qt.Equals(r.PublicKey, "-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEVGwQjd2PrVm1eey4vg6wNzKkITSS\noN8vob91XYBB6WA1Cb+KDsM/8kJ8eX1qwdXAcQg7gUdkpv+f5Dy9FvM8Cw==\n-----END PUBLIC KEY-----\n"))
}
